import{r as n,j as t,R as B,b as oe}from"./index-Dn41Jttm.js";const ne=["roads","water","drainage","lighting","waste"],ae=()=>{const f=n.useRef(null),c=n.useRef(null),S=n.useRef(null),[U,P]=n.useState(null),[r,H]=n.useState(null),[o,Y]=n.useState(null),[I,N]=n.useState("Acquiring GPS Signal..."),[ce,X]=n.useState(null),[b,w]=n.useState("searching"),[q,K]=n.useState("portrait"),[V,_]=n.useState(!1),[M,O]=n.useState(null),[l,L]=n.useState(null),[m,$]=n.useState({sector:"roads",description:"",severity:"Low"}),[de,Q]=n.useState(!1),[F,G]=n.useState("");n.useEffect(()=>{const i=setTimeout(()=>_(!0),5e3);return()=>clearTimeout(i)},[]),n.useEffect(()=>{D();const i=J(),s=()=>{const e=screen.orientation?screen.orientation.type:"portrait-primary";K(e.includes("landscape")?"landscape":"portrait")};return window.addEventListener("orientationchange",s),()=>{z(),i&&i(),window.removeEventListener("orientationchange",s)}},[]);const D=async()=>{try{const i=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1});P(i),S.current=i,f.current&&(f.current.srcObject=i)}catch{G("Camera access denied. Please allow permissions.")}},z=()=>{const i=S.current||U;i&&i.getTracks().forEach(s=>s.stop()),P(null),S.current=null},J=()=>{if(!navigator.geolocation){N("GPS Hardware Not Found");return}const i=navigator.geolocation.watchPosition(s=>{const{latitude:e,longitude:d,accuracy:g}=s.coords;H({latitude:e,longitude:d,accuracy:g,timestamp:s.timestamp}),X(g),g<=15?w("high"):g<=50?w("medium"):w("low"),g<200&&Z(e,d)},s=>{console.error(s),G("GPS Signal Lost. Move outdoors."),w("searching")},{enableHighAccuracy:!0,maximumAge:0,timeout:2e4});return()=>navigator.geolocation.clearWatch(i)},E=n.useRef(null);n.useEffect(()=>{if(!r)return;(()=>{const e=r.latitude*Math.PI/180,d=Math.pow(2,15),g=Math.floor((r.longitude+180)/360*d),A=`https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/15/${Math.floor((1-Math.log(Math.tan(e)+1/Math.cos(e))/Math.PI)/2*d)}/${g}`,y=new Image;y.crossOrigin="Anonymous",y.onload=()=>{E.current=y},y.src=A})()},[r==null?void 0:r.latitude,r==null?void 0:r.longitude]);const Z=async(i,s)=>{try{const d=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${i}&lon=${s}&addressdetails=1`)).json();d&&d.address&&(Y(d.address),N(d.display_name))}catch{}},ee=()=>{if(!f.current||!c.current||!r)return;const i=f.current,s=c.current,e=s.getContext("2d");s.width=i.videoWidth,s.height=i.videoHeight,e.drawImage(i,0,0,s.width,s.height);const d=new Date().toLocaleString(),g=r.latitude.toFixed(6),W=r.longitude.toFixed(6),A=(o==null?void 0:o.suburb)||(o==null?void 0:o.city)||(o==null?void 0:o.town)||"Unknown Location";`${(o==null?void 0:o.state)||""}${(o==null?void 0:o.country)||""}`;const y=I.substring(0,60)+(I.length>60?"...":""),u=Math.min(300,s.height*.25),k=20,a=s.height-u-k,p=u,h=k;if(E.current)e.drawImage(E.current,h,a,p,u);else{e.fillStyle="#0f172a",e.fillRect(h,a,p,u),e.strokeStyle="#1e293b",e.lineWidth=2,e.beginPath();for(let v=0;v<=4;v++)e.moveTo(h+v*p/4,a),e.lineTo(h+v*p/4,a+u),e.moveTo(h,a+v*u/4),e.lineTo(h+p,a+v*u/4);e.stroke()}e.strokeStyle="rgba(239, 68, 68, 0.6)",e.lineWidth=2,e.beginPath();const T=h+p/2,R=a+u/2;e.moveTo(T-10,R),e.lineTo(T+10,R),e.moveTo(T,R-10),e.lineTo(T,R+10),e.stroke(),e.fillStyle="rgba(239, 68, 68, 0.3)",e.beginPath(),e.arc(h+p/2,a+u/2,20,0,Math.PI*2),e.fill(),e.fillStyle="#ef4444",e.beginPath(),e.arc(h+p/2,a+u/2,6,0,Math.PI*2),e.fill(),e.strokeStyle="white",e.lineWidth=2,e.beginPath(),e.arc(h+p-20,a+20,10,0,Math.PI*2),e.stroke(),e.fillStyle="red",e.textAlign="center",e.font="bold 8px sans-serif",e.fillText("N",h+p-20,a+24),e.textAlign="left";const x=h+p+10,re=s.width-x-k;e.fillStyle="rgba(20, 20, 20, 0.85)",e.beginPath(),e.roundRect(x,a,re,u,10),e.fill(),e.fillStyle="white",e.textBaseline="top",e.font="bold 36px sans-serif",e.fillText(A,x+20,a+20),e.font="24px sans-serif",e.fillStyle="#d1d5db",e.fillText(y,x+20,a+70),e.fillStyle="white",e.font="bold 20px monospace";const C=a+u-80;e.fillText(`Lat  ${g}°`,x+20,C),e.fillText(`Long ${W}°`,x+20,C+30),e.font="18px monospace",e.fillStyle="#fbbf24",e.fillText(d,x+20,C+60);const se={captureTimestamp:new Date().toISOString(),gps:{lat:r.latitude,lng:r.longitude,accuracy:r.accuracy,timestamp:new Date(r.timestamp).toISOString()},device:{userAgent:navigator.userAgent,orientation:q,screen:`${window.screen.width}x${window.screen.height}`},validation:{isGpsAccurate:r.accuracy<=50,isRecent:Date.now()-r.timestamp<6e4}};L(se),O(s.toDataURL("image/jpeg",.9)),z()},te=()=>{O(null),L(null),D()},ie=async i=>{i.preventDefault(),Q(!0),`${m.sector.toUpperCase()}`,m.description,m.sector,r.latitude,r.longitude,l.captureTimestamp,setTimeout(()=>{alert("Verified Report Submitted Successfully!"),window.location.reload()},1500)},j=b==="high"||b==="medium"||b==="low"&&V;return t.jsxs("div",{style:{background:"#000",minHeight:"100vh",color:"white",fontFamily:"sans-serif"},children:[M?t.jsxs("div",{style:{height:"100vh",overflowY:"auto",WebkitOverflowScrolling:"touch",padding:"20px",paddingBottom:"120px",background:"#111"},children:[t.jsxs("div",{style:{position:"relative",borderRadius:"12px",overflow:"hidden",marginBottom:"20px"},children:[t.jsx("img",{src:M,style:{width:"100%",display:"block"}}),t.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0,0,0,0.7)",padding:"10px",fontSize:"10px"},children:["METADATA LOCKED: ",l==null?void 0:l.captureTimestamp]})]}),t.jsxs("div",{style:{background:"#1f2937",padding:"15px",borderRadius:"8px",marginBottom:"20px",fontSize:"12px"},children:[t.jsx("div",{style:{color:"#9ca3af",marginBottom:"4px"},children:"EVIDENCE METADATA"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[t.jsxs("div",{children:[t.jsx("span",{style:{color:"#6b7280"},children:"Device:"})," ",l==null?void 0:l.device.orientation]}),t.jsxs("div",{children:[t.jsx("span",{style:{color:"#6b7280"},children:"Acc:"})," ±",Math.round(l==null?void 0:l.gps.accuracy),"m"]}),t.jsxs("div",{style:{gridColumn:"span 2"},children:[t.jsx("span",{style:{color:"#6b7280"},children:"Time:"})," ",l==null?void 0:l.captureTimestamp]})]})]}),t.jsxs("form",{onSubmit:ie,style:{display:"flex",flexDirection:"column",gap:"15px"},children:[t.jsxs("div",{children:[t.jsx("label",{className:"data-label",children:"Sector"}),t.jsx("select",{value:m.sector,onChange:i=>$({...m,sector:i.target.value}),style:{width:"100%",padding:"12px",background:"#374151",color:"white",border:"1px solid #4b5563",borderRadius:"6px"},children:ne.map(i=>t.jsx("option",{value:i,children:i.toUpperCase()},i))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"data-label",children:"Description"}),t.jsx("textarea",{value:m.description,onChange:i=>$({...m,description:i.target.value}),required:!0,style:{width:"100%",padding:"12px",background:"#374151",color:"white",border:"1px solid #4b5563",borderRadius:"6px",minHeight:"80px"}})]}),t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx("button",{type:"button",onClick:te,style:{flex:1,padding:"15px",background:"#4b5563",color:"white",border:"none",borderRadius:"8px"},children:"Retake"}),t.jsx("button",{type:"submit",style:{flex:2,padding:"15px",background:"#10b981",color:"white",border:"none",borderRadius:"8px",fontWeight:"bold"},children:"SUBMIT REPORT"})]})]})]}):t.jsxs("div",{style:{position:"relative",height:"100vh",display:"flex",flexDirection:"column",background:"black"},children:[t.jsx("div",{className:"grid-overlay"}),t.jsx("div",{className:"scan-line"}),t.jsx("div",{className:"hud-corner hud-tl"}),t.jsx("div",{className:"hud-corner hud-tr"}),t.jsx("div",{className:"hud-corner hud-bl"}),t.jsx("div",{className:"hud-corner hud-br"}),t.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",opacity:.8}}),F&&t.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(239, 68, 68, 0.9)",color:"white",padding:"1rem",borderRadius:"8px",zIndex:100,textAlign:"center",maxWidth:"80%"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"⚠️"}),t.jsx("b",{children:"System Error"}),t.jsx("div",{style:{fontSize:"14px",marginTop:"4px"},children:F})]}),t.jsxs("div",{className:"camera-overlay",children:[t.jsxs("div",{className:"overlay-section",children:[t.jsx("div",{className:"data-label",children:"DETECTED LOCATION"}),t.jsx("div",{className:"data-value",children:(o==null?void 0:o.suburb)||(o==null?void 0:o.residential)||"Scanning Sector..."}),t.jsxs("div",{style:{fontSize:"11px",color:"rgba(255,255,255,0.7)",fontFamily:"sans-serif",marginTop:"4px"},children:[I.substring(0,45),"..."]})]}),t.jsxs("div",{className:"overlay-section",style:{alignItems:"flex-end"},children:[t.jsx("div",{className:"data-label",children:"GPS TELEMETRY"}),t.jsx("div",{className:"data-large",children:r?`${r.latitude.toFixed(4)}, ${r.longitude.toFixed(4)}`:"ACQUIRING..."}),t.jsx("div",{className:`tier-badge tier-${b}`,children:b==="high"?"LOCKED: OPTIMAL":b==="medium"?"SIGNAL: GOOD":"SIGNAL: POOR"}),t.jsxs("div",{style:{fontSize:"10px",marginTop:"4px",letterSpacing:"1px",color:"#9ca3af"},children:["PRECISION: ±",r?Math.round(r.accuracy):"--","M"]})]})]}),t.jsx("div",{style:{position:"absolute",bottom:"120px",left:0,right:0,display:"flex",justifyContent:"center",zIndex:20},children:t.jsx("button",{onClick:ee,disabled:!j,style:{width:"80px",height:"80px",borderRadius:"50%",background:j?"rgba(255,255,255,0.2)":"rgba(50,50,50,0.5)",border:j?"4px solid white":"4px solid #666",cursor:j?"pointer":"not-allowed",backdropFilter:"blur(4px)",boxShadow:"0 0 20px rgba(0,0,0,0.5)",display:"grid",placeItems:"center",transition:"all 0.3s ease"},children:t.jsx("div",{style:{width:"60px",height:"60px",background:j?"white":"#888",borderRadius:"50%"}})})})]}),t.jsx("canvas",{ref:c,style:{display:"none"}})]})};class le extends B.Component{constructor(c){super(c),this.state={hasError:!1,error:null}}static getDerivedStateFromError(c){return{hasError:!0,error:c}}componentDidCatch(c,S){console.error("Citizen App Crash:",c,S)}render(){var c;return this.state.hasError?t.jsxs("div",{style:{padding:20,color:"white",background:"#111"},children:[t.jsx("h1",{children:"Something went wrong."}),t.jsx("pre",{children:(c=this.state.error)==null?void 0:c.toString()})]}):this.props.children}}oe.createRoot(document.getElementById("root")).render(t.jsx(B.StrictMode,{children:t.jsx(le,{children:t.jsx(ae,{})})}));
